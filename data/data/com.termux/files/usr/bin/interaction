#!/bin/bash
missing=0
packages=("java" "javac" "python" "php" "gcc" "node")

for apt in ${packages[@]}; do
    if command -v "$apt" &> /dev/null; then
        echo "$apt已安装" &>/dev/null
     else
        echo "$apt未安装"
        missing=1
    fi
done

if [ "$missing" -eq 1 ]; then
    read -p "<有未下载的依赖,是否安装?(n,y)>" abc
    if [ "$abc" = "y" ] || [ "$abc" = "Y" ]; then
        if ! apt install gcc-15 python openjdk-21 nodejs php; then
            echo "安装失败!"
            exit 1
        fi
    fi
    if [ "$abc" = "n" ] || [ "$abc" = "N" ]; then
        echo "你没有选择安装依赖, 程序无法运行." abc
        exit -1
    fi
fi

while true; do
    read -p "<java模式>" file
    if [ "$file" = "quit" ]; then
        echo "再见!"
        break
    fi
    if [ -f "$file" ]; then
        javac "$file"
        name=${file%.java}
        java "$name"
        rm -rf "$name.class"
    fi
    if [ "$file" = "cpp" ]; then
        while true; do
            read -p "<c++模式>" cppfile
            if [ "$cppfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$cppfile" ]; then
                g++ -o main "$cppfile"
                ./main
                rm -rf main
            fi    
        done
    fi
    if [ "$file" = "python" ]; then
        while true; do
            read -p "<python模式>" pythonfile
            if [ "$pythonfile" = "quit" ]; then
                echo "返回java模式"
                break
            elif [ -f "$pythonfile" ]; then
                python "$pythonfile"  
            fi
        done
    fi
    if [ "$file" = "php" ]; then
        while true; do
            read -p "<php模式>" phpfile
            if [ "$phpfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$phpfile" ]; then
                php "$phpfile"
                echo
            fi
        done
    fi
    if [ "$file" = "js" ]; then
        while true; do
            read -p "<javascript模式>" jsfile
            if [ "$jsfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$jsfile" ]; then
                node "$jsfile"
            fi
        done
    fi
done
