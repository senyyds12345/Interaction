#!/bin/bash
missing=0
packages=("java" "javac" "python" "php" "gcc" "node")

for pkg in ${packages[@]}; do
    if command -v "$pkg" &> /dev/null; then
        echo "[$(date +'%Y-%m-%d %H:%M:%S')] $message" > /dev/null
    else
        echo "[$(date +'%Y-%m-%d %H:%M:%S')] $message" > /dev/null
        missing=1
    fi
done

if [ "$missing" -eq 1 ]; then
    read -p "<是否安装依赖?(n,y)>" abc
    if [ "$abc" = "y" ]; then
        if ! pkg install gcc-15 python openjdk-21 nodejs php; then
            echo "安装失败!"
            exit 1
        fi
    fi
    if [ "$abc" = "n" ]; then
        echo "程序关闭"
        break
    fi
fi
while true; do
    read -p "<java模式>" file
    if [ "$file" = "quit" ]; then
        echo "再见!"
        break
    fi
    if [ -f "$file" ]; then
        javac "$file"
        name=${file%.java}
        java "$name"
        rm -rf "$name.class"
    fi
    if [ "$file" = "cpp" ]; then
        while true; do
            read -p "<c++模式>" cppfile
            if [ "$cppfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$cppfile" ]; then
                g++ -o main "$cppfile"
                ./main
                rm -rf main
            fi    
        done
    fi
    if [ "$file" = "python" ]; then
        while true; do
            read -p "<python模式>" pythonfile
            if [ "$pythonfile" = "quit" ]; then
                echo "返回java模式"
                break
            elif [ -f "$pythonfile" ]; then
                python "$pythonfile"  
            fi
        done
    fi
    if [ "$file" = "php" ]; then
        while true; do
            read -p "<php模式>" phpfile
            if [ "$phpfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$phpfile" ]; then
                php "$phpfile"
                echo
            fi
        done
    fi
    if [ "$file" = "js" ]; then
        while true; do
            read -p "<javascript模式>" jsfile
            if [ "$jsfile" = "quit" ]; then
                echo "返回java模式"
                break    
            elif [ -f "$jsfile" ]; then
                node "$jsfile"
            fi
        done
    fi
done